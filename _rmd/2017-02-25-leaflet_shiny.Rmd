---
title: "Shiny interactive map app development"
author: matt_gregory
comments: yes
date: '2017-02-25'
modified: `r format(Sys.time(), '%Y-%m-%d')`
layout: post
excerpt: "The dangers of cherry picking evidence"
published: FALSE
status: process
tags:
- leaflet
- shiny
- mapping
- maps
categories: Rstats
output: html_document
---

```{r setup, include=FALSE}
checkpoint::setSnapshot('2016-12-22')

knitr::opts_chunk$set(
  echo = TRUE,
  dev = "svg",
  include = TRUE,
  message = FALSE,
  warning = FALSE,
  error = FALSE,
  cache = TRUE
  )
```

I've been [developing](http://www.machinegurning.com/rstats/uk_obesity/) my mapping skills in R for a couple of months now. I started off using a couple of different packages but was quickly drawn to `leaflet` which allows one to create interactive web maps with the [JavaScript 'Leaflet' Library](http://leafletjs.com/). It has loads of great features out of the box and will meet most of your mapping needs (if old fashioned people reject your interactive map you can also provide a [static version](http://stackoverflow.com/questions/31336898/how-to-save-leaflet-in-rstudio-map-as-png-or-jpg-file) using the `mapshot` function in the `mapview` package available on CRAN). 

This blog post aims to persuade you as to the merits of `leaflet` especially when combined with [shiny](https://shiny.rstudio.com/) facilitating the development of some powerful apps for your users to explore data with. To demonstrate I simulate some data and pose a question: how do `X1` and `X2` vary between schools within Local Education Authorities (LA) in England?  

# App-cherry_picker

A Shiny app for mapping School specific variables by Local Education Authority with Leaflet in R.

## The live app

[App-cherry_picker](https://mammykins.shinyapps.io/App-cherry_picker/) allows the user to investigate correlations between two made-up variables (we call them `apples` and `pears` [stairs], more interesting names than `X1` and `X2`) drawn from a uniform distribution. 
It demonstrates how [cherry picking](https://en.wikipedia.org/wiki/Cherry_picking), or finding data that supports your viewpoint (and ignoring data that does not) can be easily done even with two totally uncorrelated variables. We also use this appletunity for fruit related puns or [punnet](https://en.wikipedia.org/wiki/Punnet)-try.  

## Use the app

Give it a try: [App-cherry_picker](https://mammykins.shinyapps.io/App-cherry_picker/).  

## Clone the [code](https://github.com/mammykins/App-cherry_picker)

The code looks complicated right? Shiny can be tricky as it can be more difficult to debug than regular R. However, it's not so bad, the code is developed iteratively, it's not written in one session. Make sure you know what the end [user wants](https://en.wikipedia.org/wiki/Usability_testing) and show it to them frequently for feedback. Gradually your app 'll evolve to meet the needs of the user. The interactivity is worth the extra effort and there are plenty of [good tutorials](https://shiny.rstudio.com/tutorial/) available!  

I started this app development by going to the Shiny gallery and copying code from an [app](https://shiny.rstudio.com/tutorial/) which looked similar to the desired app I had in mind. You can do the same by copying my code as a starting point.    

## Use version control

Prior to app development of your own, make sure you are using version control such as git. Use Github (a repository hosting site; see [here for the difference between git and Github](http://stackoverflow.com/questions/13321556/difference-between-git-and-github)) or other sites to share your code. This will make life a lot easier as explained [here](https://swcarpentry.github.io/git-novice/).

## Shiny is special

Shiny is a package that contains a set of functions to build web applications within R. However, bear in mind:  

* for the correct use of its functions, files need to be organised appropriately (note the ui, server and global files found within an [App prefixed folder](https://github.com/mammykins/App-cherry_picker)).
* the syntax of its functions are slightly different to base R.

Briefly the `ui.R` is the app's frontend and the `server.R` is the backend ([more detail](https://shiny.rstudio.com/tutorial/lesson1/)). `global.R` has its own niche uses such as pre-loading packages and data that can be used both in `ui.R` and `server.R`. For example, in my app I use it to read in all the core datasets and prepare the mapping data. I also call a [custom function](https://github.com/mammykins/App-cherry_picker/blob/master/make_popup_vector_from_numeric.R) which is used to plot a school Marker on the Leaflet map.  

### UI

Here we have one of the tabs that you can navigate to. This `tabPanel` is one of four in the app that are contained within the `navbarPage` (see [ui.R](https://github.com/mammykins/App-cherry_picker/blob/master/ui.R)). Each `tabPanel` is seperated from one another by commas. It's important to lay out your code sensibly to avoid misplacing a comma, fortunately R Studio takes care of this for you.    

Note the use of HTML builder functions (e.g. `p()` and `h4()`) for constructing HTML documents (the output is an intereactive webpage).

```{r eval = FALSE}
tabPanel("Fruit limit",
         h4("Schools selected from Data explorer tab"),
         DT::dataTableOutput("green_grocers"),
         plotOutput("scatter_fruit", height = 200),
         h4("How many items of fruit required to feed the Schools of interest?"),
         p("This app was developed to showcase a Shiny app in R using the Leaflet package. Use your imagination, make a map!",
           style = "font-family: 'times'; font-si16pt")
         )
```

